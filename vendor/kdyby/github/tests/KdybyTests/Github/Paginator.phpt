<?php

/**
 * Test: Kdyby\Github\Paginator.
 *
 * @testCase KdybyTests\Github\PaginatorTest
 * @author Filip Procházka <filip@prochazka.su>
 * @package Kdyby\Github
 */

namespace KdybyTests\Github;

use Kdyby;
use Nette;
use Tester;
use Tester\Assert;



require_once __DIR__ . '/TestCase.php';



/**
 * @author Filip Procházka <filip@prochazka.su>
 */
class PaginatorTest extends TestCase
{

	public function testApi_paginatedRequest_createsPaginator()
	{
		$client = $this->buildClient();

		$this->httpClient->fakeResponse('[]', 200, array('Content-Type' => 'application/json; charset=utf-8'));
		$commitsResponse = $client->api('/repos/kdyby/github/commits', array('per_page' => 10));
		Assert::type('Kdyby\Github\Paginator', $commitsResponse);

		$this->httpClient->fakeResponse('[]', 200, array('Content-Type' => 'application/json; charset=utf-8'));
		$commitsResponse = $client->api('/repos/kdyby/github/commits', array('page' => 2));
		Assert::type('Kdyby\Github\Paginator', $commitsResponse);
	}



	public function testApi_paginatedResponse_createsPaginator()
	{
		$client = $this->buildClient();
		$this->httpClient->fakeResponse('[]', 200, array(
			'Content-Type' => 'application/json; charset=utf-8',
			'Link' => '<https://api.github.com/users?since=135>; rel="next", <https://api.github.com/users{?since}>; rel="first"'
		));

		$usersResponse = $client->api('/users');
		Assert::type('Kdyby\Github\Paginator', $usersResponse);
	}



	public function testIteration()
	{
		$client = $this->buildClient();

		$this->httpClient->fakeResponse('[{"sha":"aa622277e8868213237f5ebf4b2e9229177ad298","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T17:06:23Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T17:06:23Z"},"message":"Refactored ClientTest","tree":{"sha":"201381ddd780b980e4e01f3b52c8df88d214eee1","url":"https://api.github.com/repos/Kdyby/Github/git/trees/201381ddd780b980e4e01f3b52c8df88d214eee1"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/aa622277e8868213237f5ebf4b2e9229177ad298","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/aa622277e8868213237f5ebf4b2e9229177ad298","html_url":"https://github.com/Kdyby/Github/commit/aa622277e8868213237f5ebf4b2e9229177ad298","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/aa622277e8868213237f5ebf4b2e9229177ad298/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"8b1f2f1aa5cdd6eae054fdade055607726fe4a04","url":"https://api.github.com/repos/Kdyby/Github/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","html_url":"https://github.com/Kdyby/Github/commit/8b1f2f1aa5cdd6eae054fdade055607726fe4a04"}]},{"sha":"8b1f2f1aa5cdd6eae054fdade055607726fe4a04","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:47:36Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:47:36Z"},"message":"Travis: fixed autoload-dev for nette-2.2","tree":{"sha":"87b48a21582450d9c2dfd1133f3cdad1f2340973","url":"https://api.github.com/repos/Kdyby/Github/git/trees/87b48a21582450d9c2dfd1133f3cdad1f2340973"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","html_url":"https://github.com/Kdyby/Github/commit/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"6297c8b83e6a6ff40cea28bca6c9729173994f88","url":"https://api.github.com/repos/Kdyby/Github/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88","html_url":"https://github.com/Kdyby/Github/commit/6297c8b83e6a6ff40cea28bca6c9729173994f88"}]}]', 200, array('Content-Type' => 'application/json; charset=utf-8', 'Link' => '<https://api.github.com/repositories/19381717/commits?per_page=2&page=2>; rel="next"'));
		$this->httpClient->fakeResponse('[{"sha":"6297c8b83e6a6ff40cea28bca6c9729173994f88","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:27:11Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:27:11Z"},"message":"Fixed method in debug panel","tree":{"sha":"b0bd5c500a74b8224402e5a0e4552ec53139eb52","url":"https://api.github.com/repos/Kdyby/Github/git/trees/b0bd5c500a74b8224402e5a0e4552ec53139eb52"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88","html_url":"https://github.com/Kdyby/Github/commit/6297c8b83e6a6ff40cea28bca6c9729173994f88","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"3da40a404e40f9c6f43d91011e97b04be60ab28f","url":"https://api.github.com/repos/Kdyby/Github/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f","html_url":"https://github.com/Kdyby/Github/commit/3da40a404e40f9c6f43d91011e97b04be60ab28f"}]},{"sha":"3da40a404e40f9c6f43d91011e97b04be60ab28f","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:16:22Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:16:22Z"},"message":"fixed 5.3 compatibility","tree":{"sha":"ea0b4aab9a391d1161cd3df37875a687ecb83c51","url":"https://api.github.com/repos/Kdyby/Github/git/trees/ea0b4aab9a391d1161cd3df37875a687ecb83c51"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f","html_url":"https://github.com/Kdyby/Github/commit/3da40a404e40f9c6f43d91011e97b04be60ab28f","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"7db8aad3698ea8f5c0ad1d5d66321a2500325231","url":"https://api.github.com/repos/Kdyby/Github/commits/7db8aad3698ea8f5c0ad1d5d66321a2500325231","html_url":"https://github.com/Kdyby/Github/commit/7db8aad3698ea8f5c0ad1d5d66321a2500325231"}]}]', 200, array('Content-Type' => 'application/json; charset=utf-8', 'Link' => '<https://api.github.com/repositories/19381717/commits?per_page=2&page=3>; rel="next", <https://api.github.com/repositories/19381717/commits?per_page=2&page=1>; rel="first", <https://api.github.com/repositories/19381717/commits?per_page=2&page=1>; rel="prev"'));

		$commitsPaginator = $client->api('/repos/kdyby/github/commits', array('per_page' => 2));
		Assert::type('Kdyby\Github\Paginator', $commitsPaginator);

		$commitsPaginator->limitResults(4);

		$commitsArray = iterator_to_array($commitsPaginator);
		Assert::count(4, $commitsArray);

		Assert::count(2, $this->httpClient->requests);
	}



	public function testIteration_limitless()
	{
		$client = $this->buildClient();

		$this->httpClient->fakeResponse('[{"sha":"aa622277e8868213237f5ebf4b2e9229177ad298","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T17:06:23Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T17:06:23Z"},"message":"Refactored ClientTest","tree":{"sha":"201381ddd780b980e4e01f3b52c8df88d214eee1","url":"https://api.github.com/repos/Kdyby/Github/git/trees/201381ddd780b980e4e01f3b52c8df88d214eee1"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/aa622277e8868213237f5ebf4b2e9229177ad298","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/aa622277e8868213237f5ebf4b2e9229177ad298","html_url":"https://github.com/Kdyby/Github/commit/aa622277e8868213237f5ebf4b2e9229177ad298","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/aa622277e8868213237f5ebf4b2e9229177ad298/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"8b1f2f1aa5cdd6eae054fdade055607726fe4a04","url":"https://api.github.com/repos/Kdyby/Github/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","html_url":"https://github.com/Kdyby/Github/commit/8b1f2f1aa5cdd6eae054fdade055607726fe4a04"}]},{"sha":"8b1f2f1aa5cdd6eae054fdade055607726fe4a04","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:47:36Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:47:36Z"},"message":"Travis: fixed autoload-dev for nette-2.2","tree":{"sha":"87b48a21582450d9c2dfd1133f3cdad1f2340973","url":"https://api.github.com/repos/Kdyby/Github/git/trees/87b48a21582450d9c2dfd1133f3cdad1f2340973"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","html_url":"https://github.com/Kdyby/Github/commit/8b1f2f1aa5cdd6eae054fdade055607726fe4a04","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/8b1f2f1aa5cdd6eae054fdade055607726fe4a04/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"6297c8b83e6a6ff40cea28bca6c9729173994f88","url":"https://api.github.com/repos/Kdyby/Github/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88","html_url":"https://github.com/Kdyby/Github/commit/6297c8b83e6a6ff40cea28bca6c9729173994f88"}]}]', 200, array('Content-Type' => 'application/json; charset=utf-8', 'Link' => '<https://api.github.com/repositories/19381717/commits?per_page=2&page=2>; rel="next"'));
		$this->httpClient->fakeResponse('[{"sha":"6297c8b83e6a6ff40cea28bca6c9729173994f88","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:27:11Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:27:11Z"},"message":"Fixed method in debug panel","tree":{"sha":"b0bd5c500a74b8224402e5a0e4552ec53139eb52","url":"https://api.github.com/repos/Kdyby/Github/git/trees/b0bd5c500a74b8224402e5a0e4552ec53139eb52"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88","html_url":"https://github.com/Kdyby/Github/commit/6297c8b83e6a6ff40cea28bca6c9729173994f88","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/6297c8b83e6a6ff40cea28bca6c9729173994f88/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"3da40a404e40f9c6f43d91011e97b04be60ab28f","url":"https://api.github.com/repos/Kdyby/Github/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f","html_url":"https://github.com/Kdyby/Github/commit/3da40a404e40f9c6f43d91011e97b04be60ab28f"}]},{"sha":"3da40a404e40f9c6f43d91011e97b04be60ab28f","commit":{"author":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:16:22Z"},"committer":{"name":"Filip Procházka","email":"filip@prochazka.su","date":"2014-09-06T16:16:22Z"},"message":"fixed 5.3 compatibility","tree":{"sha":"ea0b4aab9a391d1161cd3df37875a687ecb83c51","url":"https://api.github.com/repos/Kdyby/Github/git/trees/ea0b4aab9a391d1161cd3df37875a687ecb83c51"},"url":"https://api.github.com/repos/Kdyby/Github/git/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f","comment_count":0},"url":"https://api.github.com/repos/Kdyby/Github/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f","html_url":"https://github.com/Kdyby/Github/commit/3da40a404e40f9c6f43d91011e97b04be60ab28f","comments_url":"https://api.github.com/repos/Kdyby/Github/commits/3da40a404e40f9c6f43d91011e97b04be60ab28f/comments","author":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"committer":{"login":"fprochazka","id":158625,"avatar_url":"https://avatars.githubusercontent.com/u/158625?v=2","gravatar_id":"07ac3a80e69a6252140feb81b89cbb08","url":"https://api.github.com/users/fprochazka","html_url":"https://github.com/fprochazka","followers_url":"https://api.github.com/users/fprochazka/followers","following_url":"https://api.github.com/users/fprochazka/following{/other_user}","gists_url":"https://api.github.com/users/fprochazka/gists{/gist_id}","starred_url":"https://api.github.com/users/fprochazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fprochazka/subscriptions","organizations_url":"https://api.github.com/users/fprochazka/orgs","repos_url":"https://api.github.com/users/fprochazka/repos","events_url":"https://api.github.com/users/fprochazka/events{/privacy}","received_events_url":"https://api.github.com/users/fprochazka/received_events","type":"User","site_admin":false},"parents":[{"sha":"7db8aad3698ea8f5c0ad1d5d66321a2500325231","url":"https://api.github.com/repos/Kdyby/Github/commits/7db8aad3698ea8f5c0ad1d5d66321a2500325231","html_url":"https://github.com/Kdyby/Github/commit/7db8aad3698ea8f5c0ad1d5d66321a2500325231"}]}]', 200, array('Content-Type' => 'application/json; charset=utf-8', 'Link' => '<https://api.github.com/repositories/19381717/commits?per_page=2&page=3>; rel="next", <https://api.github.com/repositories/19381717/commits?per_page=2&page=1>; rel="first", <https://api.github.com/repositories/19381717/commits?per_page=2&page=1>; rel="prev"'));

		$commitsPaginator = $client->api('/repos/kdyby/github/commits', array('per_page' => 2));
		Assert::type('Kdyby\Github\Paginator', $commitsPaginator);

		$commitsArray = array();
		foreach ($commitsPaginator as $commit) {
			$commitsArray[] = $commit;
			if (count($commitsArray) >= 4) {
				break;
			}
		}
		Assert::count(4, $commitsArray);

		Assert::count(2, $this->httpClient->requests);
	}

}

\run(new PaginatorTest());
